---
- name: Setup base configuration
  hosts: ubuntu

  pre_tasks:
    - name: Upgrade packages
      apt:
        upgrade: true
        update_cache: true

    - name: Install packages
      apt:
        update_cache: true
        pkg:
          - mosh
          - tmux
          - socat
          - tcpdump
          - silversearcher-ag
          - iputils-ping
        state: latest

  roles:
    - role: roles/hostname
    - role: roles/repo
      when: skip_repo is undefined or not skip_repo
    - role: roles/datetime
    - role: roles/locale
    - role: roles/dotfiles
    - role: roles/apticron
    - role: roles/ubuntu_no_snap
      when: snap is undefined or not snap
    - role: roles/wireguard
      when: wireguard is defined and wireguard
    - role: roles/postfix
      when: skip_postfix is not defined
    - role: roles/caddy-server
      when: caddy is defined and caddy
    - role: roles/snmpd
    - role: roles/prometheus-node-exporter
      when: skip_node_exporter is not defined
