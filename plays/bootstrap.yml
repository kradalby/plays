---
- name: Setup base configuration
  hosts: ubuntu

  # pre_tasks:
  #   - name: Upgrade packages
  #     apt:
  #       upgrade: yes
  #       update_cache: yes

  #   - name: Install packages
  #     apt:
  #       update_cache: yes
  #       pkg:
  #         - iputils-ping
  #         - mosh
  #         - tmux
  #         - socat
  #         - tcpdump
  #         - silversearcher-ag
  #         - iputils-ping
  #         - htop
  #         - iotop
  #         - lsof
  #       state: latest

  #   - name: Remove packages
  #     apt:
  #       pkg:
  #         - aide
  #       state: absent

  roles:
    # - role: roles/ubuntu-deploy-user
    #   when: deploy_user is defined and deploy_user
    # - role: roles/hostname
    # - role: roles/repo
    #   when: skip_repo is undefined or not skip_repo
    # - role: roles/datetime
    # - role: roles/locale
    # - role: roles/dotfiles
    # - role: roles/apticron
    # - role: roles/ubuntu_no_snap
    #   when: snap is undefined or not snap
    # - role: roles/wireguard
    #   when: wireguard is defined and wireguard
    # - role: roles/postfix
    #   when: skip_postfix is not defined
    - role: roles/caddy-server
      when: caddy is defined and caddy
    # - role: roles/ubuntu-swift
    #   when: swift is defined and swift
    # - role: roles/nfs-export
    #   when: nfs_exports is defined and nfs_exports|length > 0
    - role: roles/caddy_serve_files
      when: caddy_serve is defined and caddy_serve|length > 0
    - role: roles/restic-rest-server
      when: restic_rest_server is defined and restic_rest_server
    - role: roles/minio
      when: minio is defined and minio
    - role: roles/snmpd
    - role: roles/prometheus-node-exporter
      when: node_exporter is undefined or node_exporter
