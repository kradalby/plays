---
- name: Setup base configuration
  hosts: ubuntu

  pre_tasks:
    - name: Upgrade packages
      apt:
        upgrade: true
        update_cache: true

    - name: Install packages
      apt:
        update_cache: true
        pkg:
          - mosh
          - tmux
          - socat
          - tcpdump
        state: latest

  roles:
    - role: hostname
    - role: repo
      when: skip_repo is defined or not skip_repo
    - role: datetime
    - role: locale
    - role: dotfiles
    - role: apticron
    - role: postfix
      when: skip_postfix is not defined
    - role: roles/caddy-server
      when: caddy is defined and caddy
    - role: snmpd
    - role: prometheus-node-exporter
      when: skip_node_exporter is not defined
