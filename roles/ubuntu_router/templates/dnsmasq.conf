# {{ ansible_managed }}

interface={{ router_lan }}
bind-interfaces
no-hosts

log-facility=/var/log/dnsmasq.log

{% for server in router_upstream_dns %}
server={{ server }}
{% endfor %}

# domain={{ router_domain }}
# local=/{{ router_domain }}/
domain=local
local=/local/

log-dhcp
# dhcp-option=3,0.0.0.0
dhcp-option=option:router,0.0.0.0
dhcp-option=option:dns-server,0.0.0.0
# dhcp-option=6,0.0.0.0

# TODO: Check if this sorts BGP router
# dhcp-option=121,x.x.x.x/yy,z.z.z.z

# Set the DHCP server to authoritative mode to speed up leases acquisition.
dhcp-authoritative

{% if router_wan_dhcp6 %}
enable-ra

dhcp-option=option6:dns-server,[::]

dhcp-range=tag:{{ router_lan }},::1,constructor:{{ router_lan }}, ra-names, 12h
{% endif %}

dhcp-range={{ router_dhcp_start }},{{ router_dhcp_end }},12h

{% for static_lease in router_static_leases %}
dhcp-host={{ static_lease.mac }},{{ static_lease.ip }}
{% endfor %}


conf-dir=/etc/dnsmasq.d/,*.conf
